---
import { getBlogCollection, getUniqueTagsWithCount } from 'astro-pure/server'
import { Button, Icon } from 'astro-pure/user'
import { cn } from 'astro-pure/utils'
import PageLayout from '@/layouts/BaseLayout.astro'
import { integ } from '@/site-config'

import DocsContents from './DocsContents.astro'

const docsCollection = await getBlogCollection('docs')
const uniqueTags = getUniqueTagsWithCount(docsCollection).map(([tag]) => tag)

const meta = {
  title: 'Docs',
  description: 'Docs content documentation'
}
---

<PageLayout {meta}>
  <Button title='Back' href='/' variant='back' />
  <main class='mt-6 lg:mt-10'>
    <div id='content-header' class='animate'>
      <h1 class='mb-6 text-3xl font-medium'>Docs of Astro Theme Pure</h1>
    </div>

    <div class='grid gap-y-16 sm:grid-cols-[3fr_1fr] sm:gap-x-8'>
      <div id='content' class={cn('animate mt-8 max-w-none md:min-w-[45ch]', integ.typography.class)}>
        <h2 class='text-xl font-medium'>Theme documentation</h2>
        <DocsContents title={false} />

        <h2 class='text-xl font-medium'>Feedback</h2>
        <p>
          If you have any problems, you can check <a
            href='https://github.com/cworld1/astro-theme-pure/issues'
            target='_blank'>Github Issues</a
          > for community support.
        </p>
        <h2 class='text-xl font-medium'>News Describe (Alpha)</h2>
        <p>
          <a href='/docs/rss.xml' target='_blank'><Icon name='rss' /> </a>
        </p>
      </div>

      {/* sidebar */}
      {!!uniqueTags.length && (
        <aside class='animate' id='sidebar'>
          <h2 class='mb-4 flex items-center text-lg font-medium'>
            <Icon name='tag-2' class='me-2' />
            Tags
          </h2>
          <ul class='text-bgColor flex flex-wrap gap-2'>
            {
              // Only show top 50 tags in sidebar
              uniqueTags.slice(0, 50).map((tag) => (
                <li>
                  <Button title={tag} href={`/docs/tags/${tag}`} variant='pill' />
                </li>
              ))
            }
          </ul>
          <span class='mt-4 block sm:text-end'>
            <a aria-label='View all docs categories' href='/docs/tags' data-astro-prefetch>
              View all â†’
            </a>
          </span>
        </aside>
      )}
    </div>
  </main>
</PageLayout>
